image:
  repository: docker.gitea.com/gitea
  tag: 1.25.4@sha256:17d18218be2dad1f8ed402a4f906989505c90ab8b66ee9befcecfb5d470133e7
  pullPolicy: IfNotPresent

subdomain: gitea

# Deployment configuration
deployment:
  strategy: Recreate
  replicas: 1

# Container configuration - multiple ports
container:
  ports:
    - name: http
      port: 3000
      protocol: TCP
    - name: ssh
      port: 22
      protocol: TCP
  healthProbe:
    type: tcpSocket
    port: http # Use named port

# Service configuration - multiple services
service:
  ports:
    - name: http
      port: 80
      targetPort: 3000
      protocol: TCP
      type: ClusterIP
    - name: ssh
      port: 2205
      targetPort: 22
      protocol: TCP
      type: LoadBalancer
      serviceName: ssh # Results in: {release}-ssh

# Volume configuration
volumes:
  - name: data
    mountPath: /data
    persistentVolumeClaim: data

# Persistent volume claims
persistentVolumeClaims:
  - name: data
    size: 10Gi
    storageClassName: persistent

# VirtualService configuration
virtualService:
  enabled: true
  gateways:
    public: true
    private: true
  servicePort: 80 # Route to the http service port

# OIDC client configuration
oidc:
  enabled: true
  redirectUris:
    - "/user/oauth2/Authentik/callback"
  subjectMode: user_username

# Database configuration
database:
  enabled: true

# Environment variables
env:
  USER_UID: "1000"
  USER_GID: "1000"
  GITEA__server__SSH_DOMAIN:
    value: "ssh-{subdomain}.{domain}"
  GITEA__server__SSH_PORT: "2205"
  GITEA__service__REQUIRE_EXTERNAL_REGISTRATION_PASSWORD: "true"
  GITEA__service__ENABLE_PASSWORD_SIGNIN_FORM: "false"
  GITEA__service__DEFAULT_KEEP_EMAIL_PRIVATE: "true"
  GITEA__service__DEFAULT_USER_IS_RESTRICTED: "true"
  GITEA__service__DEFAULT_USER_VISIBILITY: "private"
  GITEA__service__DEFAULT_ORG_VISIBILITY: "private"
  GITEA__service__ALLOW_ONLY_EXTERNAL_REGISTRATION: "true"
  GITEA__other__SHOW_FOOTER_POWERED_BY: "false"
  GITEA__other__SHOW_FOOTER_TEMPLATE_LOAD_TIME: "false"
  GITEA__other__SHOW_FOOTER_VERSION: "false"
  GITEA__repository__ENABLE_PUSH_CREATE_USER: "true"
  GITEA__repository__ENABLE_PUSH_CREATE_ORG: "true"
  GITEA__openid__ENABLE_OPENID_SIGNIN: "false"
  GITEA__openid__ENABLE_OPENID_SIGNUP: "false"
  GITEA__database__DB_TYPE: postgres
  GITEA__database__DB_PORT: "5432"
  GITEA__database__NAME:
    valueFrom:
      secretKeyRef:
        name: "{release}-connection"
        key: database
  GITEA__database__HOST:
    valueFrom:
      secretKeyRef:
        name: "{release}-connection"
        key: host
  GITEA__database__USER:
    valueFrom:
      secretKeyRef:
        name: "{release}-connection"
        key: user
  GITEA__database__PASSWD:
    valueFrom:
      secretKeyRef:
        name: "{release}-connection"
        key: password
