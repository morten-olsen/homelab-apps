# Server image configuration
image:
  repository: ghcr.io/scanopy/scanopy/server
  tag: latest
  pullPolicy: IfNotPresent

subdomain: scanopy

# Server deployment configuration
deployment:
  strategy: Recreate
  replicas: 1
  revisionHistoryLimit: 0

# Server container configuration
container:
  ports:
    - name: http
      port: 60072
      protocol: TCP
  healthProbe:
    type: httpGet
    path: /api/health
    port: http

# Service configuration
service:
  ports:
    - name: http
      port: 80
      targetPort: 60072
      protocol: TCP
      type: ClusterIP

# Volume configuration
volumes:
  - name: data
    mountPath: /data
    persistentVolumeClaim: data

# Persistent volume claims
persistentVolumeClaims:
  - name: data
    size: 10Gi
  - name: daemon-config
    size: 1Gi

# VirtualService configuration
virtualService:
  enabled: true
  gateways:
    public: true
    private: true

# Database configuration
database:
  enabled: true

# Environment variables
env:
  SCANOPY_LOG_LEVEL: info
  SCANOPY_SERVER_PORT: "60072"
  SCANOPY_DAEMON_PORT: "60073"
  SCANOPY_WEB_EXTERNAL_PATH: /app/static
  SCANOPY_PUBLIC_URL:
    value: "https://{subdomain}.{domain}"
  SCANOPY_DATABASE_URL:
    valueFrom:
      secretKeyRef:
        name: "{release}-connection"
        key: url
  SCANOPY_INTEGRATED_DAEMON_URL:
    value: "http://{release}-daemon.{namespace}.svc.cluster.local:60073"

# Daemon configuration
daemon:
  image:
    repository: ghcr.io/scanopy/scanopy/daemon
    tag: latest
    pullPolicy: IfNotPresent
  deployment:
    strategy: Recreate
    replicas: 1
  container:
    ports:
      - name: http
        port: 60073
        protocol: TCP
    healthProbe:
      type: httpGet
      path: /api/health
      port: http
    securityContext:
      privileged: true
  service:
    ports:
      - name: http
        port: 60073
        targetPort: 60073
        protocol: TCP
        type: ClusterIP
  volumes:
    - name: daemon-config
      mountPath: /root/.config/daemon
      persistentVolumeClaim: daemon-config
  env:
    SCANOPY_LOG_LEVEL: info
    SCANOPY_SERVER_PORT: "60072"
    SCANOPY_DAEMON_PORT: "60073"
    SCANOPY_SERVER_URL:
      value: "http://{release}.{namespace}.svc.cluster.local:80"
    SCANOPY_PORT: "60073"
    SCANOPY_BIND_ADDRESS: "0.0.0.0"
    SCANOPY_NAME: scanopy-daemon
    SCANOPY_HEARTBEAT_INTERVAL: "30"
    SCANOPY_MODE: Push
